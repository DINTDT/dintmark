<head>
    <link rel="stylesheet" href="dintmark.css">
    <style>
        #input{display:inline-block;border-bottom:solid 1px #666;font-family:monospace;
            width:50%;resize:none;height:100%;vertical-align:bottom;padding:1rem}
        #output{display:inline-block;background:#eee;overflow-x:clip;height:calc(100% - 4rem);width:calc(50% - 4rem);
            overflow-y:scroll;padding:2em;}
        body{margin:0;height:100vh}

        p{text-indent:2em}
    </style>
    <script src="dintmark.js"></script>
    <script>
        var i;
        var o;
        var lang;
        var settings={};

        function processContent(e){
            var c=e.value;
            for(match of matches){c=c.replace(match[0],match[1]);}
            return c;
        }

        function processOptions(){
			for(s of document.getElementsByTagName("setting")){
				setting=s.innerHTML.split("=");
				settings[setting[0]]=setting[1];}
			lang=settings["language"]&&I18N[settings["language"]]?settings["language"]:"english";
			o.style.fontFamily=settings["font"]?settings["font"]:"serif";
			if(settings["justify"]=="true")o.classList.add("justify");
        }

        function numberHeadings(){
            hLevels=[0,0,0,0,0,0]
            ll=6;
            for(var h of document.getElementsByClassName("heading numbered")){
                var l=parseInt(h.tagName.substring(1));
                if(l<ll){for(var li=l;li<6;li++){hLevels[li]=0}}
                ll=l;
                hLevels[l-1]+=1;
                h.innerHTML=hLevels.join(". ").substring(0,l*3)+h.innerHTML;}
        }

        function processTables(){
			tables=document.getElementsByTagName("table");
			tableIndex=0;
			for (t of tables){
				t.id="TABLE"+tableIndex;
				tableIndex+=1;
				processTableContent(t);};
        }

        function processCaptions(){
			csT=0; csI=0;
			captions=document.getElementsByClassName("caption");
			for(c of captions){
				t=c.previousElementSibling;
				if(t&&t.tagName=="TABLE"){
					newC=document.createElement("caption");
					if(c.classList.contains("numbered")){csT+=1; c.innerHTML=I18N[lang]["TABLE"].replace("{x}",csT)+c.innerHTML;}
					newC.innerHTML=c.innerHTML;
					t.insertBefore(newC,t.firstElementChild);}
				else if(t&&(t.tagName=="FIGURE"||t.tagName=="A")){
					if(t.tagName=="A" && t.firstElementChild && t.firstElementChild.tagName=="FIGURE"){
						t.classList.add("figure");
						t=t.firstElementChild;}
					newC=document.createElement("figcaption");
					if(c.classList.contains("numbered")){csI+=1; c.innerHTML=I18N[lang]["FIGURE"].replace("{x}",csI)+c.innerHTML;}
					newC.innerHTML=c.innerHTML;
					t.appendChild(newC);
				}
				c.style.display="none";
			}
        }

        function render(){
            content=processContent(i);
            o.innerHTML=content;
            processOptions();
            processTables();
            numberHeadings();
            processCaptions();
        }

        window.onload=()=>{
            i=document.getElementById("input")
            o=document.getElementById("output")
            i.oninput=()=>{
                render()
            }
        }
    </script>
</head>
<body>
    <textarea id="input"></textarea><div id="output"></div>
</body>